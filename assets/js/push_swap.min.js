let ps_errors=[];const stack_a=document.getElementById("stack_a"),stack_b=document.getElementById("stack_b");let sortedTab=[],operationsList=[],numbersList=[],index=0,playerSpeed=50,playerStart=0,psType=1;function op_swap(e){let t=e.querySelector("div:first-child"),r=e.querySelector("div:nth-child(2)");return t&&r?(e.insertBefore(r,t),1):0}function op_push(e,t){let r=e.querySelector("div:first-child");return r?(t.prepend(r),1):0}function op_rotate(e){let t=e.querySelector("div:first-child");return t?(e.append(t),1):0}function op_reverse_rotate(e){let t=e.querySelector("div:last-child");return t?(e.prepend(t),1):0}function op_sa(){return op_swap(stack_a)?1:(ps_errors.push({op:"sa",index:index,error:"swap_a"}),0)}function op_sb(){return op_swap(stack_b)?1:(ps_errors.push({op:"sb",index:index,error:"swap_b"}),0)}function op_ss(){return op_swap(stack_a)&&op_swap(stack_b)?1:(ps_errors.push({op:"ss",index:index,error:"swap_ab"}),0)}function op_pa(){return op_push(stack_b,stack_a)?1:(ps_errors.push({op:"pa",index:index,error:"push_a"}),0)}function op_pb(){return op_push(stack_a,stack_b)?1:(ps_errors.push({op:"pb",index:index,error:"push_b"}),0)}function op_ra(){return op_rotate(stack_a)?1:(ps_errors.push({op:"ra",index:index,error:"rotate_a"}),0)}function op_rb(){return op_rotate(stack_b)?1:(ps_errors.push({op:"rb",index:index,error:"rotate_b"}),0)}function op_rr(){return op_rotate(stack_a)&&op_rotate(stack_b)?1:(ps_errors.push({op:"rr",index:index,error:"r_ab"}),0)}function op_rra(){return op_reverse_rotate(stack_a)?1:(ps_errors.push({op:"rra",index:index,error:"rr_a"}),0)}function op_rrb(){return op_reverse_rotate(stack_b)?1:(ps_errors.push({op:"rrb",index:index,error:"rr_b"}),0)}function op_rrr(){return op_reverse_rotate(stack_a)&&op_reverse_rotate(stack_b)?1:(ps_errors.push({op:"rrr",index:index,error:"rr_ab"}),0)}function logicChecker(){if(index-1<0)return 1;let e=operationsList[index-1],t=operationsList[index];for(let r of[{ops:["sa","sa"],error:"dup_sa"},{ops:["sb","sb"],error:"dup_sb"},{ops:["ss","ss"],error:"dup_ss"},{ops:["pa","pb"],error:"rev_pb"},{ops:["pb","pa"],error:"rev_pa"},{ops:["ra","rra"],error:"rev_rra"},{ops:["rra","ra"],error:"rev_ra"},{ops:["rb","rrb"],error:"rev_rrb"},{ops:["rrb","rb"],error:"rev_rb"},{ops:["rr","rrr"],error:"rev_rrr"},{ops:["rrr","rr"],error:"rev_rr"},])if(e===r.ops[0]&&t===r.ops[1]){ps_errors.push({op:t,index:index,error:r.error});break}return 0}function cleanStack(){stopPlayer(),operationsList=[],index=0,sortedTab=[],document.getElementById("stack_a").innerHTML="",document.getElementById("stack_b").innerHTML="",document.getElementById("home_panel").style.display="none",document.getElementById("visualize").style.display="none",document.getElementById("back_to_panel").removeAttribute("style"),document.getElementById("gen_report").removeAttribute("style"),document.getElementById("vr_ps").removeAttribute("style")}function pushSwapChecker(){let e=document.getElementById("sp_numbers").value,t=document.getElementById("sp_operations").value,r=document.getElementById("numbersList").value,n=document.getElementById("operationsList").value;numbersList=ps_split(r,e,0),operationsList=ps_split(n,t,1)}function hslToHex(e,t,r){r/=100;let n=t*Math.min(r,1-r)/100,o=t=>{let o=(t+e/30)%12,s=r-n*Math.max(Math.min(o-3,9-o,1),-1);return Math.round(255*s).toString(16).padStart(2,"0")};return`#${o(0)}${o(8)}${o(4)}`}function getColorForNumber(e,t,r){return hslToHex((e-t)/(r-t)*360,100,50)}function createVisualizerDiv(e){let t=document.createElement("div"),r=500/numbersList.length,n=(sortedTab.indexOf(e)+1)/numbersList.length*100;return t.style.width=n+"%",t.style.height=r+"px",t.style.backgroundColor=getColorForNumber(e,sortedTab[0],sortedTab[sortedTab.length-1]),t}function createViewerDiv(e){let t=document.createElement("div");return t.classList.add("stack_node"),t.innerText=e,t}function setStackA(e){document.getElementById("stackATitle").innerText="Stack A ("+sortedTab.length+")",document.getElementById("stackBTitle").innerText="Stack B (0)",document.getElementById("operationsTitle").innerText="Operations ("+operationsList.length+")",numbersList.forEach(t=>{1===e?stack_a.appendChild(createVisualizerDiv(t)):stack_a.appendChild(createViewerDiv(t))})}function setSortedTab(){let e=numbersList.slice();sortedTab=e.sort(function(e,t){return e-t})}function do_op(e,t=0){let r={sa:op_sa,sb:op_sb,ss:op_ss,pa:op_pa,pb:op_pb,ra:op_ra,rb:op_rb,rr:op_rr,rra:op_rra,rrb:op_rrb,rrr:op_rrr},n={sa:op_sa,sb:op_sb,ss:op_ss,pa:op_pb,pb:op_pa,ra:op_rra,rb:op_rrb,rr:op_rrr,rra:op_ra,rrb:op_rb,rrr:op_rr};if(0===t&&r[e]){r[e]();return}if(1===t&&n[e]){n[e]();return}console.error(`Invalid operation: ${e}`)}function viewChange(){document.getElementById("stackATitle").innerText="Stack A ("+stack_a.getElementsByTagName("div").length+")",document.getElementById("stackBTitle").innerText="Stack B ("+stack_b.getElementsByTagName("div").length+")";let e=document.getElementById("ps_next"),t=document.getElementById("ps_back"),r=document.getElementById("op_n"),n=document.getElementById("op_e"),o=document.getElementById("op_b");index+1>=operationsList.length?r.style.display="none":(r.innerText=operationsList[index+1],r.style.display="block"),index===operationsList.length?(e.setAttribute("disabled",!0),n.innerText="Finished",replay_button()):(e.removeAttribute("disabled"),n.innerText=operationsList[index]),index-1<0?(t.setAttribute("disabled",!0),o.style.display="none"):(t.removeAttribute("disabled"),o.innerText=operationsList[index-1],o.style.display="block")}function next_op(e=0){index>=operationsList.length||(1===e&&logicChecker(),do_op(operationsList[index]),index++,viewChange())}function back_op(e=0){let t=index-1;t<0||(1===e&&logicChecker(),do_op(operationsList[t],1),index--,viewChange())}function getReport(){ps_errors=[];let e=[document.getElementById("move_int"),document.getElementById("ps_back"),document.getElementById("ps_next"),document.getElementById("speed_int"),document.getElementById("ps_player")];e.forEach(e=>e.setAttribute("disabled","true")),psVisualize(psType),startPlayer_set(),startPlayer(0),psVisualize(psType),startPlayer_set(),stopPlayer(),e.forEach(e=>e.removeAttribute("disabled"))}function generate_error(e){let t={dup_sa:"Double swap on Stack A is unnecessary. This has no effect; consider removing the repeated 'sa' operations.",dup_sb:"Double swap on Stack B is unnecessary. This has no effect; consider removing the repeated 'sb' operations.",dup_ss:"Double swap between Stack A and Stack B is unnecessary. This has no effect; consider removing the repeated 'ss' operations.",rev_pb:"Unnecessary element move between Stack A and Stack B. Pushing from A to B and back to A has no net effect. Consider simplifying.",rev_pa:"Unnecessary element move between Stack B and Stack A. Pushing from B to A and back to B has no net effect. Consider simplifying.",rev_rra:"Redundant rotate and reverse-rotate on Stack A. These operations cancel each other out. Consider removing one.",rev_rrb:"Redundant rotate and reverse-rotate on Stack B. These operations cancel each other out. Consider removing one.",rev_ra:"Redundant reverse-rotate and rotate on Stack A. These operations cancel each other out. Consider removing one.",rev_rb:"Redundant reverse-rotate and rotate on Stack B. These operations cancel each other out. Consider removing one.",rev_rrr:"Redundant rotations and reverse rotations. These operations have no net effect on the stacks. Consider simplifying.",rev_rr:"Redundant reverse rotations. These operations have no net effect on the stacks. Consider simplifying.",swap_a:"The swap operation (sa) requires at least two element on Stack A. Please ensure it's not empty before attempting a swap.",swap_b:"The swap operation (sb) requires at least two element on Stack B. Please ensure it's not empty before attempting a swap.",swap_ab:"The swap operation (ss) requires at least two element on Stack A & Stack B. Please ensure it's not empty before attempting a swap.",push_a:"The Push To Stack A (pa) operation requires an element from Stack B to push to Stack A. Please ensure Stack B is not empty.",push_b:"The Push To Stack B (pb) operation requires an element from Stack A to push to Stack B. Please ensure Stack A is not empty.",rotate_a:"The rotate operation (ra) requires at least two element on Stack A. Please add elements to Stack A before attempting to rotate.",rotate_b:"The rotate operation (rb) requires at least two element on Stack B. Please add elements to Stack B before attempting to rotate.",r_ab:"The rotate operation (rr) requires at least two element on Stack A & Stack B. Please add elements to Stack A & Stack B before attempting to rotate.",rr_a:"The reverse rotate operation (rra) requires at least two element on Stack A. Please add elements to Stack A before attempting to reverse rotate.",rr_b:"The reverse rotate operation (rrb) requires at least two element on Stack B. Please add elements to Stack B before attempting to reverse rotate.",rr_ab:"The reverse rotate operation (rrr) requires at least two element on Stack A & Stack B. Please add elements to Stack A & Stack B before attempting to reverse rotate."},r="<div>";return r+="<b class='text-danger'>OP:  ("+e.index+") "+e.op+"</b> ",e.error in t?r+=t[e.error]:r+="Unknown error type.",r+="<br><hr>"}function genReport(){let e=document.getElementById("reportModalBody"),t=new bootstrap.Modal(document.getElementById("reportModal"),{keyboard:!1}),r="";e.innerText="",getReport(),t.show(),ps_errors.forEach(e=>{r+=generate_error(e)}),0===ps_errors.length&&(r="<p>No error found.</p>"),e.innerHTML=r}function sleep(e){return new Promise(t=>setTimeout(t,e))}function replay_button(){let e=document.getElementById("ps_player");e.classList.remove("bg-danger"),e.classList.remove("bg-success"),e.classList.add("bg-primary"),e.innerText="Replay",e.setAttribute("is_started","2")}function startPlayer(e=-1){if(-1===e)sleep(playerSpeed).then(()=>{if(next_op(),index===operationsList.length){replay_button();return}1===playerStart&&startPlayer()});else for(;index<operationsList.length;)next_op(1)}function stopPlayer(){let e=document.getElementById("ps_player");e.setAttribute("is_started","0"),e.innerText="start",e.classList.add("bg-success"),e.classList.remove("bg-danger"),playerStart=0}function psVisualize(e){psType=e,cleanStack(),pushSwapChecker(),setSortedTab(),setStackA(e),viewChange()}function startPlayer_set(){let e=document.getElementById("ps_player");e.setAttribute("is_started","1"),e.classList.add("bg-danger"),e.classList.remove("bg-success"),e.innerText="stop",playerStart=1}document.getElementById("back_to_panel").onclick=function(){document.getElementById("back_to_panel").style.display="none",document.getElementById("gen_report").style.display="none",document.getElementById("vr_ps").style.display="none",document.getElementById("visualize").removeAttribute("style"),document.getElementById("home_panel").removeAttribute("style")},document.getElementById("ps_next").onclick=function(){let e=parseInt(document.getElementById("move_int").value);for(;e-- >0;)next_op()},document.getElementById("ps_back").onclick=function(){let e=parseInt(document.getElementById("move_int").value);for(;e-- >0;)back_op()},document.getElementById("ps_player").onclick=function(){let e=document.getElementById("ps_player");"1"===e.getAttribute("is_started")?stopPlayer():"2"===e.getAttribute("is_started")?(psVisualize(psType),startPlayer_set(),startPlayer()):(startPlayer_set(),startPlayer())},document.getElementById("speed_int").onchange=function(){playerSpeed=parseInt(document.getElementById("speed_int").value)},document.getElementById("gen_report").onclick=function(){genReport()};